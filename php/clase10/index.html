<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" /> <title>Hello World</title>
    <script src="react.development.js"></script>
    <script src="react-dom.development.js"></script>
    <script src="babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">

class CountryList extends React.Component {
    constructor(props) {
      super(props)
      this.handleDetails = this.handleDetails.bind(this);
    }
    handleDetails(e) {
        const index = e.currentTarget.getAttribute('data-item');
        this.props.handleChangeCountry(this.props.countries[index]);
    }
    render() {
      if (this.props.countries.length > 0) {
        const rows = this.props.countries.map((country,index) =>
                    <tr key={index} data-item={index}
                        onClick={this.handleDetails}>
                    <td>{country.name}</td>
                    <td>{country.area}</td>
                    <td>{country.population}</td>
                    <td>{country.density}</td></tr>);
        return (
            <table width="100%" border="1">
              <thead><tr><th>Nombre</th><th>Area</th><th>Pop.</th>
                    <th>Dens.</th></tr></thead>
              <tbody>
                {rows}
              </tbody>
            </table>
      );
     }
     return (<p></p>)
    }
}

 class CountryForm extends React.Component {
    constructor(props) {
       super(props)
    this.state = {id:"",name:"",area:0,population:0,density:0}
    this.handleInsert = this.handleInsert.bind(this);
    this.handleUpdate = this.handleUpdate.bind(this);
    this.handleDelete = this.handleDelete.bind(this);
    this.handleFields = this.handleFields.bind(this);
    }
    componentWillReceiveProps(nextProps) {
       this.setState({id:nextProps.country.id});
       this.setState({name:nextProps.country.name});
       this.setState({area:nextProps.country.area});
       this.setState({population:nextProps.country.population});
       this.setState({density:nextProps.country.density});
    }
    handleInsert() {
        fetch("/server/index.php/country/"+this.state.id,{
            method: "post",
            headers: {'Content-Type': 'application/json',
                               'Content-Length': 20},
            body: JSON.stringify({
                method: 'put',
                name: this.state.name,
                area: this.state.area,
                population: this.state.population,
                density: this.state.density
                       })
    }).then((response) => {
           this.props.handleChangeData();
         }
    );
    }
    handleUpdate() {
        fetch("/server/index.php/country/"+this.state.id,{
            method: "post",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                      name: this.state.name,
                area: this.state.area,
                population: this.state.population,
                density: this.state.density
                       })
     }).then((response) => {
           this.props.handleChangeData();
         }
    );
    }
    handleDelete() {
        fetch("/server/index.php/country/"+this.state.id,{
            method: "post",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ method: 'delete'})
        }).then((response) => {
           this.props.handleChangeData();
         }
    );
    }
    handleFields(event) {
     const target = event.target;
     const value = target.value;
     const name = target.name;
     this.setState({[name]: value});
  }
    render() {
        return(<form><table><tbody>
           <tr><td width="30%"><label>Nombre:</label></td>
               <td width="20%"><input type="text" name="name"
                   value={this.state.name} onChange={this.handleFields}/></td></tr>
           <tr><td><label>Area:</label></td>
               <td><input type="text" name="area"
                   value={this.state.area} onChange={this.handleFields}/></td></tr>
           <tr><td><label>Population:</label></td>
               <td><input type="text" name="population"
                   value={this.state.population} onChange={this.handleFields}/></td></tr>
           <tr><td><label>Density:</label></td>
               <td><input type="text" name="density"
                   value={this.state.density} onChange={this.handleFields}/></td></tr>
           </tbody></table><input type="hidden" name="id" value={this.state.id}/>
           <table><tbody><tr>
               <td><button onClick={this.handleInsert}>Agregar</button></td>
               <td><button onClick={this.handleUpdate}>Modificar</button></td>
               <td><button onClick={this.handleDelete}>Eliminar</button></td>
           </tr></tbody></table></form>)
    }
}

class App extends React.Component {
     constructor(props) {
        super(props)
          this.state = { countries: [], country: [] }
          this.handleReload = this.handleReload.bind(this);
          this.handleChangeData = this.handleChangeData.bind(this);
          this.handleChangeCountry = this.handleChangeCountry.bind(this);
       }
       handleReload() {
         fetch('/server/index.php/country')
           .then((response) => {
               return response.json()
           })
           .then((data) => {
               this.setState({ countries: data });
               this.forceUpdate();
           })
       }
       componentWillMount() {
           this.handleReload();
       }
     handleChangeData() {
           this.handleReload();
       }
       handleChangeCountry(data) {
           this.setState({country: data})
       }
     render() {
           return (<table width="100%" border="1"><tbody><tr>
           <td width="70%"><CountryList countries={this.state.countries}
                 handleChangeCountry={this.handleChangeCountry}/></td>
           <td width="30%"><CountryForm country={this.state.country}
                 handleChangeData={this.handleChangeData}/></td>
           </tr></tbody></table>)
     }
 }
ReactDOM.render(<App/>, document.getElementById('root'));

   </script>
  </body>
</html>